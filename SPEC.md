# Tech & Gov Stream - 機能仕様書 (SPEC.md)

## 概要
X Pro (旧TweetDeck) スタイルの横スクロール型ニュースリーダー。
技術（Tech）と政府・政策（Gov）の最新動向を、ユーザーがカスタマイズしたカラムで効率的に収集・閲覧できるアプリケーション。

---

## 1. ユーザーインターフェース (UI)

### 1-1. レイアウト
- **ストリーム型カラム**: 複数のニュースフィードを横一列に並べ、水平スクロールで閲覧。
- **カラム幅**: 固定幅（340px）。
- **スクロール挙動**: `snap-x` によるスナップスクロール（1カラムずつ停止）。
- **テーマ**: ダークモード（デフォルト）/ライトモード切り替え対応。
- **レスポンシブ**: モバイル端末ではスワイプ操作で快適に閲覧可能。

### 1-2. ヘッダー
- **ロゴ**: アプリタイトル。
- **ソース管理ボタン**: ⚙️ アイコン。クリックで「ソースをカスタマイズ」ダイアログを表示。
- **テーマ切り替え**: ☀️/🌙 アイコンでモード変更。

---

## 2. ニュース閲覧機能

### 2-1. 記事カード
各記事は以下の要素で構成されるカードとして表示。
- **画像（サムネイル）**:
    - RSS内の `media:content`, `enclosure`, `img` タグから自動抽出。
    - 画像がない場合は記事ページからOGP画像を非同期で取得（最大10件/フィード）。
    - 取得失敗時は非表示（レイアウト自動調整）。
    - アスペクト比 16:9 で上部に表示。
- **記事タイトル**: 最大3行まで表示。
- **発行元**: ソース名（Zenn, Qiita, Google Newsなど）をバッジ表示。
- **公開日時**: `MM/DD HH:mm` 形式。
- **要約**: 最大150文字。画像ありの場合は2行、なしの場合は3行まで表示。
- **リンク**: カード全体がクリック可能（別タブで開く）。

### 2-2. 更新機能
- **自動更新**: 5分ごとにバックグラウンドで再取得（SWR `refreshInterval: 300000`）。
- **手動更新**: カラムヘッダーの 🔄 ボタンで即時更新。
- **読み込み状態**: ローディング中はスケルトンUIを表示。
- **エラー処理**: 取得失敗時はエラーメッセージと再試行ボタンを表示。

---

## 3. カスタマイズ機能

### 3-1. オンボーディング
- 初回起動時（またはカラム数が0の時）、自動的に「ソースをカスタマイズ」ダイアログを表示。

### 3-2. ソース管理（Source Manager）
以下の3つの方法でカラムを追加可能。

#### A. プリセット（Presets）
厳選されたソースのカタログから選択。
- **Tech**: Zenn, Qiita, TechCrunch JP, Publickey
- **Gov/Policy**: デジタル庁, 経産省, AI規制・政策(Google News), 総務省

#### B. キーワード検索（Keyword）
任意のキーワードを入力し、Google NewsのRSSを生成して追加。
- 例: "生成AI", "Web3", "働き方改革"

#### C. RSS URL直接入力
RSS/AtomフィードのURLを直接指定して追加。

### 3-3. カラム操作
- **並び替え**: カラムヘッダー左側のハンドル（⋮⋮）をドラッグ＆ドロップして並び替え可能（`dnd-kit`使用）。
- **削除**: カラムヘッダー右側の × ボタンで即座に削除。
- **追加**: カラム末尾の「＋」ボタンからもソース管理画面を開ける。

---

## 4. データ・バックエンド仕様

### 4-1. RSS取得ロジック (`/api/feed`)
- **プロキシ**: CORS回避のため、Next.js Route Handler経由でRSSを取得。
- **パース処理**: `xml2js` を使用。RSS 1.0, 2.0, Atom 形式に対応。
- **正規化**: 異なるフォーマットの差異を吸収し、統一された `Article` オブジェクトに変換。
- **画像抽出優先度**:
    1. `media:content` / `media:thumbnail`
    2. `enclosure` (画像判定ロジック含む)
    3. 本文中の `<img>` タグ
    4. OGP画像 (フォールバック)

### 4-2. 状態管理
- **Zustand (`useFeedStore`)**:
    - カラム設定（ID, タイトル, URL, ソース名）を管理。
    - 現在はローカルメモリ（リロードでリセット）で動作。
    - *Future: Supabase等での永続化予定。*

---

## 5. 技術スタック
- **Frontend**: Next.js 15 (App Router), React, TypeScript
- **UI Components**: Shadcn/UI (Radix UI), Tailwind CSS, Lucide React
- **State Management**: Zustand
- **Data Fetching**: SWR
- **Drag & Drop**: @dnd-kit
- **Utilities**: dayjs, xml2js, clsx

---

## 6. 今後の実装予定
- [ ] **Supabase連携**: ユーザー認証、設定のクラウド保存。
- [ ] **未読管理**: 既読状態のトラッキング。
- [ ] **フィルタリング**: 特定キーワードの除外/強調。
